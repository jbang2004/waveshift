# WaveShift TTS Engine

<div align="center">

![Version](https://img.shields.io/badge/version-2.0.0-blue.svg)
![Platform](https://img.shields.io/badge/platform-Local%20%2B%20Cloudflare-orange.svg)
![GPU](https://img.shields.io/badge/GPU-CUDA%20Supported-green.svg)
![Python](https://img.shields.io/badge/python-3.9+-blue.svg)

ğŸš€ **ä¸“ä¸šçš„IndexTTSè¯­éŸ³åˆæˆå¼•æ“**

åŸºäºIndexTTS v0.1.4çš„é«˜æ€§èƒ½TTSæœåŠ¡ï¼Œä¸Cloudflare Workeré›†æˆæ„æˆå®Œæ•´çš„åª’ä½“å¤„ç†ç®¡é“

</div>

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

WaveShift TTS Engine æ˜¯ä¸€ä¸ªä¸“æ³¨çš„æ–‡å­—è½¬è¯­éŸ³ï¼ˆTTSï¼‰å¼•æ“ï¼Œä»å¤æ‚çš„è§†é¢‘ç¿»è¯‘ç³»ç»Ÿé‡æ„ä¸ºä¸“é—¨çš„è¯­éŸ³åˆæˆæœåŠ¡ã€‚é€šè¿‡ç®€åŒ–æ¶æ„å’Œå¹¶è¡Œä¼˜åŒ–ï¼Œå®ç°äº†é«˜æ€§èƒ½ã€é«˜è´¨é‡çš„TTSå¤„ç†ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **IndexTTSé›†æˆ**: åŸºäºå…ˆè¿›çš„IndexTTS v0.1.4æ¨¡å‹
- **çœŸæ­£å¹¶è¡Œæ¶æ„**: ä¸‰é˜¶æ®µæµæ°´çº¿å¹¶è¡Œå¤„ç†
- **æ™ºèƒ½éŸ³é¢‘å¤„ç†**: è¯­éŸ³åˆ†ç¦»ã€éŸ³é¢‘åˆ‡åˆ†ã€è¯­éŸ³å…‹éš†
- **äº‘åŸç”Ÿè®¾è®¡**: ä¸Cloudflare D1/R2æ·±åº¦é›†æˆ
- **HLSæµåª’ä½“**: å®æ—¶æµåª’ä½“è¾“å‡ºæ”¯æŒ

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **Webæ¡†æ¶**: FastAPI + Uvicorn
- **TTSæ¨¡å‹**: IndexTTS v0.1.4 (PyTorch)
- **æ•°æ®å­˜å‚¨**: Cloudflare D1 (SQLiteå…¼å®¹)
- **æ–‡ä»¶å­˜å‚¨**: Cloudflare R2 (S3å…¼å®¹)
- **éŸ³é¢‘å¤„ç†**: PyDub + ONNX Runtime
- **è§†é¢‘å¤„ç†**: FFmpeg
- **å¹¶å‘å¤„ç†**: AsyncIO + æµæ°´çº¿æ¶æ„

### ç»„ä»¶æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WaveShift TTS Engine                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Entry Points:                                             â”‚
â”‚  â€¢ app.py          - ä¸»åº”ç”¨å…¥å£                             â”‚
â”‚  â€¢ api.py          - FastAPI RESTæ¥å£                      â”‚
â”‚  â€¢ launcher.py     - æœåŠ¡åˆå§‹åŒ–å™¨                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Core Services:                                            â”‚
â”‚  â€¢ DataFetcher     - æ•°æ®è·å–ä¸é¢„å¤„ç†                       â”‚
â”‚  â€¢ MyIndexTTS      - TTSè¯­éŸ³åˆæˆå¼•æ“                        â”‚
â”‚  â€¢ DurationAligner - æ—¶é•¿å¯¹é½ä¸æ–‡æœ¬ç®€åŒ–                     â”‚
â”‚  â€¢ MediaMixer      - éŸ³è§†é¢‘æ··åˆ                            â”‚
â”‚  â€¢ HLSManager      - HLSæµåª’ä½“ç®¡ç†                         â”‚
â”‚  â€¢ MainOrchestrator- ä¸»æµç¨‹ç¼–æ’å™¨                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  External Integrations:                                    â”‚
â”‚  â€¢ Cloudflare D1   - è½¬å½•æ•°æ®å­˜å‚¨                          â”‚
â”‚  â€¢ Cloudflare R2   - åª’ä½“æ–‡ä»¶å­˜å‚¨                          â”‚
â”‚  â€¢ Translation AI - æ–‡æœ¬ç®€åŒ–æœåŠ¡                           â”‚
â”‚  â€¢ VocalSeparator  - éŸ³é¢‘åˆ†ç¦»                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ å®Œæ•´æ•°æ®æµç¨‹

### ç³»ç»Ÿè¾“å…¥
1. **ä»»åŠ¡ID** - å”¯ä¸€æ ‡è¯†å¤„ç†ä»»åŠ¡
2. **D1æ•°æ®åº“** - è½¬å½•æ–‡æœ¬ã€æ—¶é—´æˆ³ã€è¯´è¯äººä¿¡æ¯
3. **R2å­˜å‚¨** - åŸå§‹éŸ³é¢‘æ–‡ä»¶ã€é™éŸ³è§†é¢‘æ–‡ä»¶

### æ ¸å¿ƒå¤„ç†æµç¨‹

#### é˜¶æ®µ1: æ•°æ®è·å–ä¸é¢„å¤„ç† (DataFetcher)
```
è¾“å…¥: task_id
â”œâ”€â”€ å¹¶è¡ŒD1æŸ¥è¯¢
â”‚   â”œâ”€â”€ è·å–è½¬å½•ç‰‡æ®µ (transcription_segments)
â”‚   â””â”€â”€ è·å–åª’ä½“è·¯å¾„ (media_tasks)
â”œâ”€â”€ éŸ³é¢‘å¤„ç†é“¾
â”‚   â”œâ”€â”€ å¼‚æ­¥ä¸‹è½½éŸ³é¢‘æ–‡ä»¶ (R2Client)
â”‚   â””â”€â”€ éŸ³é¢‘åˆ†ç¦» (VocalSeparator) - å¯é€‰
â”‚       â”œâ”€â”€ äººå£°åˆ†ç¦» (vocals.wav)
â”‚       â””â”€â”€ èƒŒæ™¯éŸ³åˆ†ç¦» (instrumental.wav)
â”‚   
â”‚   æ³¨æ„ï¼šéŸ³é¢‘åˆ‡åˆ†åŠŸèƒ½å·²ç”± audio-segment-worker æœåŠ¡å®ç°
â””â”€â”€ è§†é¢‘ä¸‹è½½ (åå°ä»»åŠ¡)
    â””â”€â”€ å¼‚æ­¥ä¸‹è½½é™éŸ³è§†é¢‘
```

#### é˜¶æ®µ2: TTSæµå¼å¤„ç† (ä¸‰é˜¶æ®µå¹¶è¡Œæµæ°´çº¿)
```
æµæ°´çº¿æ¶æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  é˜Ÿåˆ—1   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  é˜Ÿåˆ—2   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TTS Producer  â”‚ â”€â”€â”€â”€â”€â”€â†’ â”‚ Align&Adjust    â”‚ â”€â”€â”€â”€â”€â”€â†’ â”‚  Media Composer  â”‚
â”‚  éŸ³é¢‘ç”Ÿæˆ      â”‚         â”‚ æ—¶é•¿ä¼˜åŒ–        â”‚         â”‚  åª’ä½“åˆæˆ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**TTS Producer**: æ‰¹é‡å¤„ç†å¥å­ã€IndexTTSæ¨¡å‹æ¨ç†ã€è¯­éŸ³å…‹éš†éŸ³é¢‘ç”Ÿæˆ  
**Align & Adjust**: æ—¶é•¿å¯¹é½ã€è¶…é€Ÿå¥å­æ£€æµ‹ä¸æ–‡æœ¬ç®€åŒ–ã€æ—¶é—´æˆ³è°ƒæ•´  
**Media Composer**: éŸ³è§†é¢‘æ··åˆã€HLSåˆ†æ®µç”Ÿæˆã€å¹¶è¡Œä¸Šä¼ åˆ°R2

#### é˜¶æ®µ3: HLSæµåª’ä½“è¾“å‡º
```
HLSå¤„ç†æµç¨‹:
â”œâ”€â”€ åˆ†æ®µç”Ÿæˆ (segment_*.mp4)
â”œâ”€â”€ æ’­æ”¾åˆ—è¡¨æ›´æ–° (.m3u8)
â”œâ”€â”€ å¹¶è¡Œä¸Šä¼ åˆ°R2
â”‚   â”œâ”€â”€ åˆ†æ®µæ–‡ä»¶ä¸Šä¼ 
â”‚   â””â”€â”€ æ’­æ”¾åˆ—è¡¨ä¸Šä¼ 
â”œâ”€â”€ æœ€ç»ˆåˆå¹¶
â”‚   â”œâ”€â”€ è§†é¢‘åˆ†æ®µæ‹¼æ¥
â”‚   â””â”€â”€ å®Œæ•´è§†é¢‘ç”Ÿæˆ
â””â”€â”€ æ•°æ®åº“çŠ¶æ€æ›´æ–°
```

### ç³»ç»Ÿè¾“å‡º
1. **HLSæ’­æ”¾åˆ—è¡¨** - å®æ—¶æµåª’ä½“æ’­æ”¾
2. **å®Œæ•´è§†é¢‘æ–‡ä»¶** - æœ€ç»ˆåˆå¹¶çš„MP4æ–‡ä»¶  
3. **ä»»åŠ¡çŠ¶æ€æ›´æ–°** - D1æ•°æ®åº“çŠ¶æ€åŒæ­¥

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®å¿…è¦å‚æ•°
```

### 2. å¯åŠ¨æœåŠ¡

```bash
# ç›´æ¥å¯åŠ¨
python app.py

# æˆ–ä½¿ç”¨å¯åŠ¨è„šæœ¬
bash start.sh
```

### 3. éªŒè¯éƒ¨ç½²

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/api/health

# å¯åŠ¨TTSä»»åŠ¡
curl -X POST http://localhost:8000/api/start_tts \
  -H "Content-Type: application/json" \
  -d '{"task_id": "your-task-id"}'
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®å¿…è¦å‚æ•°ï¼š

```bash
# Cloudflare é…ç½®
CLOUDFLARE_ACCOUNT_ID=your_account_id
CLOUDFLARE_API_TOKEN=your_api_token
CLOUDFLARE_D1_DATABASE_ID=your_database_id
CLOUDFLARE_R2_ACCESS_KEY_ID=your_r2_access_key
CLOUDFLARE_R2_SECRET_ACCESS_KEY=your_r2_secret_key
CLOUDFLARE_R2_BUCKET_NAME=your_bucket_name

# AI æ¨¡å‹é…ç½® (ç”¨äºæ–‡æœ¬ç®€åŒ–)
TRANSLATION_MODEL=deepseek  # æ”¯æŒ: deepseek/gemini/grok/groq
DEEPSEEK_API_KEY=your_deepseek_key  # å¯¹åº”æ¨¡å‹çš„APIå¯†é’¥

# éŸ³é¢‘åˆ†ç¦»é…ç½®
ENABLE_VOCAL_SEPARATION=true
VOCAL_SEPARATION_MODEL=Kim_Vocal_2.onnx
VOCAL_SEPARATION_OUTPUT_FORMAT=WAV
VOCAL_SEPARATION_SAMPLE_RATE=24000

# TTS é…ç½®
SAVE_TTS_AUDIO=true         # ä¿å­˜TTSç”Ÿæˆçš„éŸ³é¢‘
CLEANUP_TEMP_FILES=false    # ä¿ç•™ä¸´æ—¶æ–‡ä»¶ç”¨äºè°ƒè¯•
TTS_BATCH_SIZE=3           # TTSæ‰¹å¤„ç†å¤§å°
TARGET_SR=24000            # ç›®æ ‡é‡‡æ ·ç‡

# HLS é…ç½®
ENABLE_HLS_STORAGE=true     # å¯ç”¨R2å­˜å‚¨
CLEANUP_LOCAL_HLS_FILES=false
```

## ğŸš€ æ ¸å¿ƒä¼˜åŒ–ç‰¹æ€§

### 1. çœŸæ­£å¹¶è¡Œå¤„ç†æ¶æ„
- **æ•°æ®è·å–é˜¶æ®µ**: D1æŸ¥è¯¢ã€éŸ³é¢‘ä¸‹è½½ã€è§†é¢‘ä¸‹è½½çœŸæ­£å¹¶è¡Œ
- **TTSå¤„ç†é˜¶æ®µ**: ä¸‰é˜¶æ®µæµæ°´çº¿å¹¶è¡Œï¼Œæœ€å¤§åŒ–èµ„æºåˆ©ç”¨
- **ä¸Šä¼ é˜¶æ®µ**: åå°é˜Ÿåˆ—å¼å¹¶è¡Œä¸Šä¼ åˆ°R2

### 2. æ™ºèƒ½éŸ³é¢‘å¤„ç†
- **è¯­éŸ³åˆ†ç¦»**: Kim_Vocal_2.onnxæ¨¡å‹åˆ†ç¦»äººå£°ä¸èƒŒæ™¯éŸ³
- **æ™ºèƒ½åˆ‡åˆ†**: åŸºäºè¯´è¯äººåˆ†ç»„çš„éŸ³é¢‘åˆ‡ç‰‡ä¼˜åŒ–
- **è¯­éŸ³å…‹éš†**: ä¸ºæ¯ä¸ªè¯´è¯äººç”Ÿæˆä¸“å±éŸ³é¢‘æ ·æœ¬

### 3. é«˜çº§TTSåŠŸèƒ½
- **æ—¶é•¿è‡ªé€‚åº”**: è‡ªåŠ¨å¯¹é½TTSè¾“å‡ºä¸åŸå§‹æ—¶é—´è½´
- **æ–‡æœ¬ç®€åŒ–**: AIé©±åŠ¨çš„è¶…é€Ÿå¥å­æ–‡æœ¬ä¼˜åŒ–
- **æµå¼ç”Ÿæˆ**: æ‰¹é‡å¼‚æ­¥TTSå¤„ç†

### 4. ä¼ä¸šçº§å¯é æ€§
- **é”™è¯¯æ¢å¤**: å¤šå±‚çº§é™çº§ç­–ç•¥
- **èµ„æºç®¡ç†**: æ™ºèƒ½å†…å­˜æ¸…ç†å’ŒGPUç¼“å­˜ç®¡ç†
- **çŠ¶æ€è¿½è¸ª**: å®Œæ•´çš„ä»»åŠ¡çŠ¶æ€ç”Ÿå‘½å‘¨æœŸç®¡ç†

## ğŸ“Š æ€§èƒ½ç‰¹å¾

### å¤„ç†èƒ½åŠ›
- **TTSå¤„ç†é€Ÿåº¦**: å®æ—¶4-6å€é€Ÿåº¦
- **å¹¶å‘å¤„ç†**: æ”¯æŒå¤šä»»åŠ¡å¹¶è¡Œå¤„ç†
- **å†…å­˜ä¼˜åŒ–**: æ»‘åŠ¨çª—å£ç¼“å†²åŒºç®¡ç†
- **GPUåŠ é€Ÿ**: CUDAè‡ªåŠ¨æ£€æµ‹ä¸ä¼˜åŒ–

### æ‰©å±•æ€§è®¾è®¡
- **æ¨¡å—åŒ–æ¶æ„**: æ¾è€¦åˆæœåŠ¡è®¾è®¡
- **å¼‚æ­¥ä¼˜å…ˆ**: å…¨æµç¨‹å¼‚æ­¥å¤„ç†
- **é…ç½®é©±åŠ¨**: ä¸°å¯Œçš„ç¯å¢ƒå˜é‡é…ç½®
- **ç›‘æ§å‹å¥½**: è¯¦ç»†çš„æ—¥å¿—å’Œæ€§èƒ½æŒ‡æ ‡

## ğŸ“Š APIæ¥å£

å¯åŠ¨æœåŠ¡åï¼Œå¯é€šè¿‡ä»¥ä¸‹æ¥å£è®¿é—®ï¼š

```bash
# åŸºç¡€URL (é»˜è®¤: http://localhost:8000)
BASE_URL="http://localhost:8000"

# å¥åº·æ£€æŸ¥
curl "${BASE_URL}/api/health"

# å¯åŠ¨TTSä»»åŠ¡
curl -X POST "${BASE_URL}/api/start_tts" \
  -H "Content-Type: application/json" \
  -d '{"task_id": "your-task-id"}'

# æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
curl "${BASE_URL}/api/task/{task_id}/status"
```

### API å“åº”ç¤ºä¾‹

```json
// å¯åŠ¨ä»»åŠ¡å“åº”
{
  "status": "processing",
  "task_id": "d8a62769-4bc3-490c-90c2-0991b418344a",
  "message": "TTSåˆæˆæµç¨‹å·²å¼€å§‹"
}

// ä»»åŠ¡çŠ¶æ€å“åº”
{
  "task_id": "d8a62769-4bc3-490c-90c2-0991b418344a",
  "status": "completed",
  "hls_playlist_url": "https://pub-xxx.r2.dev/hls/task_id/playlist.m3u8"
}
```

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
waveshift-tts-engine/
â”œâ”€â”€ app.py                    # ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ api.py                    # FastAPI RESTæ¥å£
â”œâ”€â”€ launcher.py               # æœåŠ¡åˆå§‹åŒ–å™¨
â”œâ”€â”€ orchestrator.py           # ä¸»æµç¨‹ç¼–æ’å™¨
â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â”œâ”€â”€ core/                     # æ ¸å¿ƒæœåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ data_fetcher.py       # æ•°æ®è·å–ä¸é¢„å¤„ç†
â”‚   â”œâ”€â”€ audio_segmenter.py    # æ™ºèƒ½éŸ³é¢‘åˆ‡åˆ†
â”‚   â”œâ”€â”€ my_index_tts.py       # TTSè¯­éŸ³åˆæˆå¼•æ“
â”‚   â”œâ”€â”€ timeadjust/           # æ—¶é•¿å¯¹é½æ¨¡å—
â”‚   â”œâ”€â”€ media_mixer.py        # éŸ³è§†é¢‘æ··åˆ
â”‚   â”œâ”€â”€ hls_manager.py        # HLSæµåª’ä½“ç®¡ç†
â”‚   â”œâ”€â”€ cloudflare/           # Cloudflareé›†æˆ
â”‚   â””â”€â”€ translation/          # æ–‡æœ¬ç®€åŒ–æœåŠ¡
â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”œâ”€â”€ models/                   
â”‚   â”œâ”€â”€ IndexTTS/             # IndexTTSæ¨¡å‹
â”‚   â””â”€â”€ audio-separator-models/ # éŸ³é¢‘åˆ†ç¦»æ¨¡å‹
â””â”€â”€ requirements.txt          # ä¾èµ–åˆ—è¡¨
```

### å…³é”®æŠ€æœ¯å®ç°

#### 1. IndexTTSé›†æˆ
```python
# core/my_index_tts.py
async def generate_audio_stream(self, sentences, path_manager):
    for sentence in sentences:
        # è¯­éŸ³å…‹éš†æ¨ç†
        res = await asyncio.to_thread(
            self.tts_model.infer,
            sentence.audio,  # è¯­éŸ³æ ·æœ¬
            sentence.translated_text,  # ç›®æ ‡æ–‡æœ¬
            None, False
        )
```

#### 2. å¹¶è¡Œæ•°æ®è·å–
```python
# core/data_fetcher.py
async def fetch_task_data(self, task_id, path_manager):
    # é˜¶æ®µ1: å¹¶è¡ŒD1æŸ¥è¯¢
    sentences_task = asyncio.create_task(get_sentences())
    media_paths_task = asyncio.create_task(get_media_paths())
    
    # é˜¶æ®µ2: çœŸæ­£å¹¶è¡Œåª’ä½“å¤„ç†
    audio_task = asyncio.create_task(audio_processing_chain())
    video_task = asyncio.create_task(video_download())
```

#### 3. ä¸‰é˜¶æ®µæµæ°´çº¿
```python
# orchestrator.py
async def _process_tts_stream(self, task_id, sentences, ...):
    tts_queue = asyncio.Queue(maxsize=20)
    aligned_queue = asyncio.Queue(maxsize=20)
    
    # ä¸‰ä¸ªå¹¶è¡Œä»»åŠ¡
    tts_task = asyncio.create_task(tts_producer())
    preprocess_task = asyncio.create_task(align_and_adjust())
    compose_task = asyncio.create_task(media_composer())
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**Q: IndexTTSæ¨¡å‹åŠ è½½å¤±è´¥**
```bash
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
ls models/IndexTTS/checkpoints/
# ç¡®ä¿åŒ…å«: config.yaml, gpt.pth, dvae.pth, bigvgan_*.pth
```

**Q: GPUå†…å­˜ä¸è¶³**
```bash
# è°ƒæ•´æ‰¹å¤„ç†å¤§å°
TTS_BATCH_SIZE=1  # åœ¨ .env ä¸­è®¾ç½®
```

**Q: Cloudflareè¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥é…ç½®
echo $CLOUDFLARE_API_TOKEN
# éªŒè¯æƒé™å’Œç½‘ç»œè¿æ¥
```

## ğŸ¯ ç³»ç»Ÿä¼˜åŠ¿

### 1. é«˜æ€§èƒ½æ¶æ„
- çœŸæ­£çš„å¹¶è¡Œå¤„ç†æ¶æ„ï¼Œé¿å…é˜»å¡ç­‰å¾…
- æµæ°´çº¿å¼å¤„ç†ï¼Œèµ„æºåˆ©ç”¨ç‡æœ€å¤§åŒ–
- æ™ºèƒ½ç¼“å­˜å’Œå†…å­˜ç®¡ç†

### 2. é«˜è´¨é‡è¾“å‡º
- IndexTTSå…ˆè¿›è¯­éŸ³åˆæˆæŠ€æœ¯
- åŸºäºAIçš„æ–‡æœ¬ä¼˜åŒ–
- ä¸“ä¸šçº§éŸ³é¢‘å¤„ç†

### 3. é«˜å¯é æ€§
- å¤šå±‚é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
- å®Œæ•´çš„çŠ¶æ€è¿½è¸ªå’Œç›‘æ§
- äº‘åŸç”Ÿæ¶æ„è®¾è®¡

### 4. é«˜æ‰©å±•æ€§
- æ¨¡å—åŒ–å¾®æœåŠ¡æ¶æ„
- é…ç½®é©±åŠ¨çš„çµæ´»æ€§
- æ”¯æŒæ°´å¹³æ‰©å±•

---

**WaveShift TTS Engine** - ç°ä»£AIè¯­éŸ³å¤„ç†ç³»ç»Ÿçš„æœ€ä½³å®è·µï¼Œé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„å¹¶è¡Œæ¶æ„å’Œä¼˜åŒ–ç®—æ³•ï¼Œå®ç°é«˜æ€§èƒ½ã€é«˜è´¨é‡çš„TTSæœåŠ¡ã€‚