# Serverless Devs é…ç½®æ–‡ä»¶
# ç”¨äºéƒ¨ç½²é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—3.0è‡ªå®šä¹‰å®¹å™¨æœåŠ¡

edition: 3.0.0          # Serverless Devsç‰ˆæœ¬
name: fc-denoise-app    # åº”ç”¨åç§°
access: default         # è®¿é—®å‡­è¯é…ç½®åç§°

vars:
  region: ap-southeast-1   # ğŸŒ é˜¿é‡Œäº‘åŒºåŸŸ (æ–°åŠ å¡ï¼Œä¸ACRåŒåŒºåŸŸ)
  functionName: fc-denoise-service

resources:
  fc-denoise-dev:       # æœåŠ¡åç§°
    component: fc3      # ä½¿ç”¨FC 3.0ç»„ä»¶
    props:
      region: ${vars.region}
      
      # å‡½æ•°é…ç½®
      function:
        functionName: ${vars.functionName}
        description: "ZipEnhanceréŸ³é¢‘é™å™ªæœåŠ¡ - åŸºäºæ·±åº¦å­¦ä¹ çš„å®æ—¶éŸ³é¢‘é™å™ª"
        
        # è¿è¡Œæ—¶é…ç½®
        runtime: custom-container
        
        # è‡ªå®šä¹‰å®¹å™¨é…ç½®
        customContainerConfig:
          # ğŸ¯ å®¹å™¨é•œåƒåœ°å€ï¼ˆç”¨æˆ·çš„ACRä»“åº“ï¼‰
          image: crpi-nw2oorfhcjjmm5o0.ap-southeast-1.personal.cr.aliyuncs.com/waveshifttts/fc-denoise:v1.0
          port: 9000
          # å¯é€‰ï¼šå®¹å™¨å¯åŠ¨å‘½ä»¤è¦†ç›–
          # command: ["python", "fc_denoise_server.py"]
          # args: []
        
        # ğŸ”§ èµ„æºé…ç½®ï¼ˆç»è¿‡æ€§èƒ½æµ‹è¯•ä¼˜åŒ–ï¼‰
        memorySize: 4096    # 4GBå†…å­˜ï¼ˆZipEnhanceræ¨¡å‹éœ€æ±‚ï¼‰
        cpu: 2.0           # 2 vCPUï¼ˆç›¸æ¯”CF Containeræå‡4å€ï¼‰
        timeout: 300       # 5åˆ†é’Ÿè¶…æ—¶ï¼ˆé•¿éŸ³é¢‘å¤„ç†ï¼‰
        
        # ç¯å¢ƒå˜é‡
        environmentVariables:
          PYTHONUNBUFFERED: "1"
          FC_RUNTIME_VERSION: "3.0"
          OMP_NUM_THREADS: "2"
          MKL_NUM_THREADS: "2"
          ORT_NUM_THREADS: "2"
          
        # ğŸŒ ç½‘ç»œé…ç½®
        internetAccess: true
        
        # ğŸ“Š æ—¥å¿—é…ç½®
        logConfig:
          project: fc-denoise-logs
          logstore: function-logs
          enableRequestMetrics: true
          enableInstanceMetrics: true
        
        # ğŸš€ å®ä¾‹é…ç½®
        instanceConcurrency: 1      # å•å®ä¾‹å¹¶å‘ï¼ˆé™å™ªè®¡ç®—å¯†é›†ï¼‰
        instanceType: e1           # ç»æµå‹å®ä¾‹
        
        # æ€§èƒ½ä¼˜åŒ–é…ç½®
        initializationTimeout: 60   # åˆå§‹åŒ–è¶…æ—¶ï¼ˆæ¨¡å‹åŠ è½½æ—¶é—´ï¼‰
        
      # HTTPè§¦å‘å™¨é…ç½®
      triggers:
        - name: http-trigger
          type: http
          config:
            authType: anonymous     # ğŸ”“ åŒ¿åè®¿é—®ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®æ”¹ä¸ºfunctionï¼‰
            methods:
              - GET
              - POST
              - OPTIONS
            # CORSé…ç½®
            cors:
              allowOrigin: "*"
              allowMethods: 
                - GET
                - POST
                - OPTIONS
              allowHeaders:
                - Content-Type
                - X-Segment-Id
                - X-Speaker
                - X-Enable-Streaming
                - X-Input-Format
              maxAge: 3600

